| What you have now                                                                             | Why it can bite you                                                                                                           | Suggested fix / example                                                                                                                                                                                                                               |
| --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| *Per‑asset calls* – e.g. `yf.Ticker('^IXIC').history()` and similar one‑offs for VIX and TNX  | A separate HTTPS call for every ticker scales **O(n)**; latency jumps when you add the 100‑plus symbols in your sector lists. | Use **vectorised batch download**:  `yf.download(tickers, start=…, end=…, group_by='ticker', auto_adjust=True, threads=True)` returns a multi‑index frame that you can reshape once.                                                                  |
| Pulls the *whole* look‑back window every day                                                  | Wastes bandwidth & API quota; you already have 99 % of yesterday’s data on disk.                                              | Track the **latest date per ticker** (e.g. in a small “manifest” table) and call `yf.download(start=last_date + pd.Timedelta('1D'))`. Append only new rows.                                                                                           |
| No retry / back‑off logic                                                                     | Occasional 503s from Yahoo kill the refresh thread.                                                                           | Wrap download in `tenacity.retry` (or your own exponential‑back‑off loop) with jittered sleeps.                                                                                                                                                       |
| Market Cap not collected                                                                      | Your “sector EMA” logic needs market‑weighting.                                                                               | After the price download, call *one* fundamentals endpoint (e.g. Finnhub `/stock/metric?metric=marketCapitalization`) or read `yf.Ticker.info['sharesOutstanding']` once per day, then compute `mkt_cap = close × shares`.  Persist it next to price. |
